# Express.js API Template

A comprehensive Express.js API template with modern features including authentication, file upload, database migrations, testing, and auto-generated API documentation.

## üöÄ Features

### **üéØ NEW: Automated Migration Generator**
- **üöÄ Auto-generate migrations** from existing models - no manual work needed!
- **üìù CLI migration tools** for creating tables, columns, indexes with simple commands
- **üîç Smart analyzer** automatically detects missing migrations
- **üîó Relations and Foreign Keys** - automatic foreign key constraint generation
- **üìä Index support** - create indexes from model definitions
- **‚úÖ Complete rollback support** - all migrations include proper down() methods
- **üé® Supports all Sequelize data types** (ENUM, DECIMAL, JSON, etc.)

### Core Features
- **Express.js v5** - Latest version with native async/await support
- **Database Support** - SQLite (default), MySQL/MariaDB and PostgreSQL with Sequelize ORM
- **Zero Database Setup** - Uses SQLite by default for immediate development
- **Authentication** - JWT-based authentication system
- **File Upload Support** - Dual storage system (local + S3-compatible)
- **Image Processing** - Automatic resize, format conversion (JPG, WebP, AVIF, PNG)
- **Redis Integration** - Optional Redis support for caching and session management
- **Database Migrations** - Full migration and seeding support with automation
- **Auto-generated Documentation** - Swagger/OpenAPI 3.0 documentation
- **Input Validation** - Request validation with Joi
- **Unit Testing** - Comprehensive test suite with Jest (168+ tests)
- **Utility Functions** - Comprehensive utils library for dates, strings, validation, crypto
- **Security** - Security best practices with Helmet, CORS, Rate limiting
- **Error Handling** - Centralized error handling
- **Environment Configuration** - Multiple environment support
- **Logging** - Request logging with Morgan and Winston
- **Email Service** - SMTP email support with templates
- **Compression** - Response compression for better performance

## üìã Prerequisites

- Node.js (>= 22.0.0) or Bun (>= 1.0.0)
- npm, yarn, pnpm, or bun

### Installing Package Managers

**pnpm with Corepack (Recommended - Node.js 16.13+):**
```bash
corepack enable
corepack prepare pnpm@latest --activate
```

**Bun (All-in-one toolkit):**
```bash
curl -fsSL https://bun.sh/install | bash
```Import specific utilities:
```javascript
const { formatDate, isValidEmail, successResponse } = require('./src/utils');
```

### üîç Utility Examples

Run the comprehensive examples to see all utilities in action:

**Using npm:**
```bash
npm run examples
```

**Using yarn:**
```bash
yarn examples
```

**Using pnpm:**
```bash
pnpm examples
```

**Using bun:**
```bash
bun run examples
```

This will demonstrate:
- **Enhanced date formatting and calculations** with dayjs
- **Advanced date comparisons and ranges** 
- **Timezone support and business day calculations**
- **String transformations and validation**
- **Data validation and sanitization** 
- **Cryptographic operations**
- **Standardized API responses**
- **File operations and validation**

## üîí Security Features

- **Helmet** - Sets various HTTP headers
- **CORS** - Cross-Origin Resource Sharing
- **Rate Limiting** - Prevents abuse
- **Input Validation** - Joi validation schemas
- **JWT Authentication** - Secure token-based auth
- **Password Hashing** - bcrypt with salt rounds
- **SQL Injection Protection** - Sequelize ORM
- **Date/Time Operations** - Enhanced date utilities powered by dayjs
- **File Storage** - Dual storage system: local storage and S3-compatible object storage (AWS S3, MinIO, DigitalOcean Spaces) with advanced image processing
- **Image Processing** - Automatic resize, format conversion (JPG, WebP, AVIF, PNG), quality optimization with environment-based configuration
- **Redis Integration** - Optional Redis support for caching, session management, rate limiting, and background job processing
- **Database Migrations** - Full migration and seeding support
- **Auto-generated Documentation** - Swagger/OpenAPI 3.0 documentation
- **Input Validation** - Request validation with Joi
- **Unit Testing** - Comprehensive test suite with Jest
- **Utility Functions** - Comprehensive utils library for dates, strings, validation, crypto, responses, and files
- **Security** - Security best practices with Helmet, CORS, Rate limiting
- **Error Handling** - Centralized error handling
- **Code Organization** - Clean architecture with separation of concerns
- **Environment Configuration** - Multiple environment support
- **Logging** - Request logging with Morgan and Winston
- **Email Service** - SMTP email support with templates
- **Compression** - Response compression for better performance

## üìã Prerequisites

- Node.js (>= 22.0.0) or Bun (>= 1.0.0)
- npm, yarn, pnpm, or bun

### Installing Package Managers

**pnpm with Corepack (Recommended - Node.js 16.13+):**
```bash
corepack enable
corepack prepare pnpm@latest --activate
```

**pnpm with npm:**
```bash
npm install -g pnpm
```

**pnpm with standalone script:**
```bash
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

**Bun (All-in-one toolkit):**
```bash
curl -fsSL https://bun.sh/install | bash
```

## üõ†Ô∏è Installation

1. Clone the repository:
    ```bash
    git clone <repository-url>
    cd express-api-template
    ```

2. Install dependencies:

    **Using npm:**
    ```bash
    npm install
    ```

    **Using yarn:**
    ```bash
    yarn install
    ```

    **Using pnpm:**
    ```bash
    pnpm install
    ```

    **Using bun:**
    ```bash
    bun install
    ```

3. Copy environment variables:
    ```bash
    cp .env.example .env
    ```

4. Edit the `.env` file with your configuration

5. Run database migrations (optional - SQLite works out of the box):

    **Using npm:**
    ```bash
    npm run migrate
    ```

    **Using yarn:**
    ```bash
    yarn migrate
    ```

    **Using pnpm:**
    ```bash
    pnpm migrate
    ```

    **Using bun:**
    ```bash
    bun run migrate
    ```

6. Seed the database with sample data (optional):

    **Using npm:**
    ```bash
    npm run seed
    ```

    **Using yarn:**
    ```bash
    yarn seed
    ```

    **Using pnpm:**
    ```bash
    pnpm seed
    ```

    **Using bun:**
    ```bash
    bun run seed
    ```

## üöÄ Quick Start

1. Start the development server:

    **Using npm:**
    ```bash
    npm run dev
    ```

    **Using yarn:**
    ```bash
    yarn dev
    ```

    **Using pnpm:**
    ```bash
    pnpm dev
    ```

    **Using bun:**
    ```bash
    bun run dev
    ```

2. The API will be available at `http://localhost:3000`

3. View API documentation at `http://localhost:3000/api-docs` (development only)

4. Check health endpoint: `http://localhost:3000/health`

## üéØ Smart Migration System

‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ CLI ‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Sequelize migrations ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û

### üöÄ Quick Start Commands

```bash
# üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á migrations ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
npm run migrate analyze

# üìù ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ models ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ migrations
npm run migrate list

# üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
npm run migrate status

# üîÑ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á models ‡πÅ‡∏•‡∏∞ database
npm run migrate sync:check

# ‚ö° ‡∏£‡∏±‡∏ô migrations ‡∏õ‡∏Å‡∏ï‡∏¥
npm run migrate:up

# ‚è™ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å migration ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
npm run migrate:down

# üìã ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ migrations ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
npm run migrate:status
```

### ÔøΩÔ∏è CLI Migration Generator

‡∏™‡∏£‡πâ‡∏≤‡∏á migrations ‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á CLI ‡∏ó‡∏µ‡πà‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß:

#### ‡∏™‡∏£‡πâ‡∏≤‡∏á Table ‡πÉ‡∏´‡∏°‡πà
```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á table ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
npm run migrate create:table products

# ‡∏™‡∏£‡πâ‡∏≤‡∏á table ‡∏û‡∏£‡πâ‡∏≠‡∏° columns
npm run migrate create:table products -c \
  "name:STRING(100):allowNull=false" \
  "price:DECIMAL:allowNull=false" \
  "description:TEXT:allowNull=true"

# ‡∏™‡∏£‡πâ‡∏≤‡∏á table ‡πÑ‡∏°‡πà‡∏°‡∏µ timestamps
npm run migrate create:table logs --no-timestamps -c \
  "message:STRING:allowNull=false" \
  "level:ENUM(info,warning,error):defaultValue=info"
```

#### ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Columns
```bash
# ‡πÄ‡∏û‡∏¥‡πà‡∏° column
npm run migrate add:column products stock "INTEGER:allowNull=false,defaultValue=0"

# ‡∏•‡∏ö column
npm run migrate remove:column products oldField

# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç column
npm run migrate modify:column products price "DECIMAL(10,2):allowNull=false"
```

#### ‡πÄ‡∏û‡∏¥‡πà‡∏° Foreign Keys ‡πÅ‡∏•‡∏∞ Relations
```bash
# ‡πÄ‡∏û‡∏¥‡πà‡∏° foreign key constraint
npm run migrate add:foreign-key orders customerId users id --on-delete CASCADE
npm run migrate add:foreign-key products categoryId categories id --on-delete SET_NULL
```

#### ‡πÄ‡∏û‡∏¥‡πà‡∏° Indexes
```bash
# ‡πÄ‡∏û‡∏¥‡πà‡∏° index ‡∏õ‡∏Å‡∏ï‡∏¥
npm run migrate add:index products name

# ‡πÄ‡∏û‡∏¥‡πà‡∏° unique index
npm run migrate add:index products slug -u

# ‡πÄ‡∏û‡∏¥‡πà‡∏° composite index
npm run migrate add:index orders "userId,status" -n "idx_user_orders"
```

### ‚ú® Auto-Generated Features

**‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:**
- ‚úÖ Tables ‡∏û‡∏£‡πâ‡∏≠‡∏° columns ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏° model definition
- ‚úÖ Foreign key constraints ‡πÅ‡∏•‡∏∞ relations
- ‚úÖ Indexes ‡∏ï‡∏≤‡∏° model definition
- ‚úÖ Data types ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (ENUM, DECIMAL, JSON, etc.)
- ‚úÖ onUpdate/onDelete constraints
- ‚úÖ Rollback migrations ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

### ‚úÖ Migration Testing

‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö migrations ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏° Auto-Cleanup:

```bash
# üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Migration System ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
npm run test:migrate

# üëÄ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö watch mode
npm run test:migrate:watch  

# üìã ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
npm run test:migrate:verbose
```

**‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:**
- ‚úÖ **8 Test Suites** ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå
- üßπ **Auto-Cleanup** ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
- üîÑ **Zero Impact** ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
- ‚ö° **‡πÄ‡∏£‡πá‡∏ß** ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- üõ°Ô∏è **‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢** ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á

| Type | Format | Example |
|------|--------|---------|
| STRING | `STRING` or `STRING(length)` | `STRING(100)` |
| TEXT | `TEXT` | `TEXT` |
| INTEGER | `INTEGER` | `INTEGER` |
| DECIMAL | `DECIMAL` or `DECIMAL(precision,scale)` | `DECIMAL(10,2)` |
| BOOLEAN | `BOOLEAN` | `BOOLEAN` |
| DATE | `DATE` | `DATE` |
| ENUM | `ENUM(val1,val2,...)` | `ENUM(active,inactive)` |
| JSON | `JSON` | `JSON` |

### üéØ Supported Data Types

| Option | Values | Description |
|--------|--------|-------------|
| `allowNull` | `true/false` | Allow NULL values |
| `unique` | `true/false` | Unique constraint |
| `primaryKey` | `true/false` | Primary key |
| `autoIncrement` | `true/false` | Auto increment |
| `defaultValue` | `any` | Default value |

### ÔøΩ Migration Workflow

### üí° Migration Workflow

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà:**
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á models ‡∏ï‡∏≤‡∏° requirements
2. ‡∏£‡∏±‡∏ô `npm run migrate analyze` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á migrations ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
3. ‡∏£‡∏±‡∏ô `npm run migrate:up` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ apply migrations

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà:**
1. ‡∏£‡∏±‡∏ô `npm run migrate list` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
2. ‡πÉ‡∏ä‡πâ CLI commands ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á schema
3. ‡∏£‡∏±‡∏ô `npm run migrate:up` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ apply changes

## üê≥ Docker Deployment

### Available Docker Configurations

This project provides multiple Docker configurations optimized for different environments:

#### 1. Node.js Production
```bash
# Build and start with Node.js runtime
docker-compose -f docker-compose.nodejs.yml up -d

# View logs
docker-compose -f docker-compose.nodejs.yml logs -f api
```

#### 2. Bun Production (Faster Performance)
```bash
# Build and start with Bun runtime
docker-compose -f docker-compose.bun.yml up -d

# View logs  
docker-compose -f docker-compose.bun.yml logs -f api
```

#### 3. Development Environment
```bash
# Start development environment with hot reload
docker-compose -f docker-compose.dev.yml up -d
```

### Docker Features

- **Multi-runtime Support**: Node.js and Bun configurations
- **Production Optimized**: Multi-stage builds for smaller images
- **Development Ready**: Hot reload and development tools
- **Database Included**: PostgreSQL and Redis containers
- **Security**: Non-root user and secure configurations
- **Health Checks**: Built-in health monitoring

### Environment-specific Images

- **Production (Node.js)**: Optimized for stability and compatibility
- **Production (Bun)**: Optimized for performance and speed
- **Development**: Includes development tools and hot reload

## ‚ö° Runtime Support

### Node.js (Recommended for Production)
```bash
# Install dependencies
npm install

# Development server
npm run dev

# Production server  
npm start

# Run tests
npm test

# Migration tools
npm run migrate analyze
npm run migrate create:table products
```

### Bun (Performance Optimized)

This project is fully compatible with Bun for enhanced performance:

**Benefits:**
- üöÄ **Performance**: Up to 4x faster than Node.js
- üì¶ **Built-in package manager**: No separate package manager needed
- üîß **Compatible test runner**: Runs Jest tests efficiently
- üîÑ **Node.js compatibility**: Drop-in replacement

**Commands:**
```bash
# Install dependencies
bun install

# Development server (with hot reload)
bun run dev

# Production server
bun run start

# Run tests (using Jest through Bun)
bun run test

# Migration tools
bun run migrate analyze
bun run migrate create:table products
```

**Database Compatibility:**
All database drivers (SQLite, MySQL/MariaDB, PostgreSQL) work seamlessly with Bun.

## üìö API Documentation

The API documentation is automatically generated using Swagger/OpenAPI 3.0:

- **Development/Local**: http://localhost:3000/api-docs
- **Production**: Disabled for security (API docs not exposed)

### Security Note
API documentation is automatically disabled in production environments (`NODE_ENV=production`) to prevent exposing internal API structure and sensitive information.

## üóÑÔ∏è Database Configuration

### SQLite (Default)

No additional configuration needed. The database file will be created automatically.

### MySQL/MariaDB

Update your `.env` file:

```env
DB_DIALECT=mysql
DB_HOST=localhost
DB_PORT=3306
DB_NAME=your_database_name
DB_USERNAME=your_username
DB_PASSWORD=your_password
```

### PostgreSQL

Update your `.env` file:

```env
DB_DIALECT=postgres
DB_HOST=localhost
DB_PORT=5432
DB_NAME=your_database_name
DB_USERNAME=your_username
DB_PASSWORD=your_password
```

## ÔøΩ Redis Configuration (Optional)

Redis is included in Docker Compose setups for enhanced performance and scalability features. While the API works perfectly without Redis, it provides additional capabilities when available.

### üöÄ Redis Use Cases

#### **1. üè™ Caching & Performance**
- **API Response Caching**: Cache expensive database queries and computed results
- **User Session Storage**: Enhanced session management for better performance
- **File Metadata Caching**: Cache file information for faster retrieval

#### **2. üîí Enhanced Security**
- **JWT Token Blacklist**: Store invalidated tokens for secure logout functionality
- **Rate Limiting Storage**: Persistent rate limiting across server restarts
- **IP Tracking**: Advanced request monitoring and abuse prevention

#### **3. üìß Background Processing**
- **Email Queue**: Queue email sending jobs for better reliability
- **Job Processing**: Background task management and retry mechanisms
- **Notification System**: Real-time notification delivery

#### **4. üìä Real-time Features**
- **WebSocket Management**: Connection state management for real-time features
- **Live Updates**: Push notifications and live data updates
- **Messaging**: Chat and messaging capabilities

### üîß Redis Configuration

**Docker Compose** (Included):
```yaml
redis:
  image: redis:7-alpine
  ports:
    - "6379:6379"
```

**Environment Variables** (Optional):
```env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password
REDIS_DB=0
```

### üí° Current Status
- **Status**: Ready-to-use infrastructure included in Docker setups
- **Implementation**: Currently optional - API works without Redis
- **Future**: Easy to implement Redis features as needed
- **Benefits**: Significant performance gains in production environments

### üéØ Quick Setup
```bash
# Start with Redis (Docker Compose)
docker-compose -f docker-compose.nodejs.yml up -d

# Redis will be available at localhost:6379
# No additional configuration needed
```

## ÔøΩüîê Authentication

The API uses JWT-based authentication. Default users (created by seeder):

- **Admin**: admin@example.com / admin123
- **User**: user@example.com / user123

### Authentication Endpoints:

- `POST /api/auth/register` - Register new user
- `POST /api/auth/login` - Login user
- `GET /api/auth/me` - Get current user profile
- `PUT /api/auth/change-password` - Change password
- `POST /api/auth/forgot-password` - Request password reset
- `POST /api/auth/reset-password` - Reset password with token

## üë• User Management

### User Endpoints:

- `GET /api/users` - Get all users (Admin only)
- `GET /api/users/:id` - Get user by ID
- `PUT /api/users/:id` - Update user
- `DELETE /api/users/:id` - Delete user (Admin only)
- `PATCH /api/users/:id/toggle-status` - Toggle user status (Admin only)

## üìÅ File Upload & Storage

### Dual Storage System

The API supports both local storage and S3-compatible object storage with seamless switching:

- **Local Storage**: Files stored on server filesystem
- **S3-Compatible Storage**: AWS S3, MinIO, DigitalOcean Spaces, and other S3-compatible services

### Storage Configuration

Switch between storage types using environment variables:

```env
# Local Storage (default)
UPLOAD_STORAGE=local
UPLOAD_PATH=uploads/

# S3-Compatible Storage
UPLOAD_STORAGE=s3
S3_ENDPOINT=https://s3.amazonaws.com  # For AWS S3, or your S3-compatible endpoint
S3_REGION=us-east-1
S3_BUCKET=your-bucket-name
S3_ACCESS_KEY_ID=your-access-key
S3_SECRET_ACCESS_KEY=your-secret-key
S3_FORCE_PATH_STYLE=false  # Set to true for MinIO or other S3-compatible services
```

### Image Processing Configuration

Control image processing behavior via environment variables:

```env
# Image Processing Control
IMAGE_RESIZE=true                    # Enable/disable image resizing
IMAGE_CONVERT=true                   # Enable/disable automatic format conversion
IMAGE_QUALITY=80                     # Default image quality (1-100)
IMAGE_MAX_WIDTH=1920                 # Maximum allowed width
IMAGE_MAX_HEIGHT=1080                # Maximum allowed height
MAX_FILE_SIZE=10485760              # Maximum file size in bytes (10MB)
```

### Upload Endpoints:

- `POST /api/upload/single` - Upload single file with optional image processing
- `POST /api/upload/multiple` - Upload multiple files with optional image processing
- `DELETE /api/upload/:filename` - Delete uploaded file
- `GET /api/upload/info/:filename` - Get file information
- `GET /api/upload/list` - List all uploaded files
- `GET /api/upload/download/:filename` - Download file
- `GET /api/upload/storage/status` - Get current storage configuration

### Image Processing Features:

- **Intelligent Resize**: Automatically resize images that exceed maximum dimensions
- **Format Conversion**: Convert images to modern formats (WebP, AVIF) for better compression
- **Quality Control**: Optimize image quality for perfect balance between size and quality
- **Format Support**: JPEG, PNG, WebP, and AVIF
- **Conditional Processing**: Only processes image files, preserves other file types
- **Error Recovery**: Falls back to original file if processing fails
- **Multi-format Output**: Support for JPG, PNG, WebP, and AVIF output formats

### Example Usage:

```bash
# Upload with automatic WebP conversion and quality optimization
curl -X POST http://localhost:3000/api/upload/single \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "outputFormat=webp" \
  -F "quality=85"

# Upload with custom resize dimensions
curl -X POST http://localhost:3000/api/upload/single \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "resize=800x600" \
  -F "outputFormat=avif" \
  -F "quality=90"

# Check storage status
curl -X GET http://localhost:3000/api/upload/storage/status \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### S3-Compatible Storage Features:

- **Multi-provider Support**: AWS S3, MinIO, DigitalOcean Spaces, and more
- **Multipart Upload**: Efficient handling of large files
- **Object Metadata**: Automatic content-type detection and metadata storage
- **Path-style URLs**: Support for both virtual-hosted-style and path-style URLs
- **Security**: Proper access control and error handling

### File Security:

- File type validation based on MIME type
- File size limits enforced
- Secure filename generation
- Path traversal protection
- Malicious file detection

## üß™ Testing

Run tests:

```bash
npm test
```

Run tests in watch mode:

```bash
npm run test:watch
```

Generate test coverage:

```bash
npm run test:coverage
```

## üìä Database Migrations

Create a new migration:

**üéØ Migration Generation (NEW):**

```bash
npm run migrate analyze         # Auto-generate missing migrations
npm run migrate list            # List model migration status
npm run migrate create:table    # CLI migration generator
```

**Traditional Database Operations:**

```bash
npx sequelize-cli migration:generate --name migration-name
```

Run migrations:

```bash
npm run migrate:up
```

Undo last migration:

```bash
npm run migrate:down
```

Create a new seeder:

```bash
npx sequelize-cli seed:generate --name seeder-name
```

Run seeders:

```bash
npm run seed
```

## üìß Email Service

Configure SMTP settings in your `.env` file:

```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
```

Email templates are located in `src/templates/`.

## ÔøΩÔ∏è Utility Functions

The API includes a comprehensive set of utility functions in `src/utils/` to help with common operations:

### üìÖ Date Utils (Powered by dayjs)
```javascript
const { formatToISO, formatDate, addDays, isToday, getRelativeTime } = require('./src/utils');

// Format dates with flexible options
formatToISO(new Date()); // "2023-12-25T10:30:00.000Z"
formatDate(new Date()); // "December 25, 2023"
formatDate(new Date(), 'YYYY-MM-DD'); // "2023-12-25"
formatDateTime(new Date(), 'MMM D, YYYY [at] h:mm A'); // "Dec 25, 2023 at 10:30 AM"

// Advanced date calculations
addDays(new Date(), 7); // Add 7 days
subtractDays(new Date(), 3); // Subtract 3 days
addTime(new Date(), 2, 'hour'); // Add 2 hours
getRelativeTime(pastDate); // "2 hours ago"

// Date comparisons and checks
isToday(someDate); // Check if date is today
isYesterday(someDate); // Check if date is yesterday
isFuture(someDate); // Check if date is in future
isBetween(date, startDate, endDate); // Check if date is in range

// Date ranges and business logic
startOfDay(new Date()); // Start of current day
endOfMonth(new Date()); // End of current month
getBusinessDays(startDate, endDate); // Count business days
getAge(birthdate); // Calculate age from birthdate

// Parsing and timezone support
parseDate('15/12/2023', 'DD/MM/YYYY'); // Parse with custom format
toTimezone(new Date(), 'America/New_York'); // Convert to timezone
```

### üî§ String Utils
```javascript
const { capitalize, toCamelCase, slugify, truncate } = require('./src/utils');

// String transformations
capitalize('hello world'); // "Hello world"
toCamelCase('hello world'); // "helloWorld"
slugify('Hello World!'); // "hello-world"
truncate('Long text...', 50); // Truncate with ellipsis
```

### ‚úÖ Validation Utils
```javascript
const { isValidEmail, validatePassword, isEmpty } = require('./src/utils');

// Validate data
isValidEmail('user@example.com'); // true
validatePassword('StrongPass123!'); // { isValid: true, score: 5 }
isEmpty(value); // Check for empty values
```

### üîê Crypto Utils
```javascript
const { generateSecureToken, hashPassword, generateUUID } = require('./src/utils');

// Secure operations
generateSecureToken(32); // Random hex token
generateUUID(); // UUID v4
await hashPassword('password'); // Bcrypt hash
```

### üì§ Response Utils
```javascript
const { successResponse, errorResponse, notFoundResponse } = require('./src/utils');

// Standardized API responses
successResponse(res, data, 'Success message');
errorResponse(res, 'Error message', 400);
notFoundResponse(res, 'User');
```

### üìÅ File Utils
```javascript
const { getFileExtension, formatFileSize, isValidFileType } = require('./src/utils');

// File operations
getFileExtension('image.jpg'); // "jpg"
formatFileSize(1048576); // "1 MB"
isValidFileType('image.jpg', ['jpg', 'png']); // true
```

### üìö Usage Examples

Import all utilities:
```javascript
const utils = require('./src/utils');
// Access: utils.formatDate(), utils.isValidEmail(), etc.
```

Import specific utilities:
```javascript
const { formatDate, isValidEmail, successResponse } = require('./src/utils');
```

## ÔøΩüîí Security Features

- **Helmet** - Sets various HTTP headers
- **CORS** - Cross-Origin Resource Sharing
- **Rate Limiting** - Prevents abuse
- **Input Validation** - Joi validation schemas
- **JWT Authentication** - Secure token-based auth
- **Password Hashing** - bcrypt with salt rounds
- **SQL Injection Protection** - Sequelize ORM

## üìù Logging

Logs are stored in the `logs/` directory:

- `error.log` - Error logs only
- `combined.log` - All logs

Log levels: error, warn, info, debug

## üåç Environment Variables

Key environment variables:

```env
# Server Configuration
NODE_ENV=development
PORT=3000

# Database Configuration
DB_DIALECT=sqlite
DB_HOST=localhost
DB_NAME=your_database_name
DB_USERNAME=your_username
DB_PASSWORD=your_password

# Authentication
JWT_SECRET=your-jwt-secret

# Email Service
SMTP_HOST=smtp.gmail.com
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-password

# File Upload & Storage
UPLOAD_STORAGE=local                 # 'local' or 's3'
UPLOAD_PATH=uploads/                 # Local storage path
MAX_FILE_SIZE=10485760              # Maximum file size (10MB)
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif

# Image Processing
IMAGE_RESIZE=true                    # Enable automatic resizing
IMAGE_CONVERT=true                   # Enable format conversion
IMAGE_QUALITY=80                     # Default quality (1-100)
IMAGE_MAX_WIDTH=1920                 # Maximum width
IMAGE_MAX_HEIGHT=1080                # Maximum height

# S3-Compatible Storage
S3_ENDPOINT=https://s3.amazonaws.com # S3 endpoint URL
S3_REGION=us-east-1                  # S3 region
S3_BUCKET=your-bucket-name           # S3 bucket name
S3_ACCESS_KEY_ID=your-access-key     # S3 access key
S3_SECRET_ACCESS_KEY=your-secret-key # S3 secret key
S3_FORCE_PATH_STYLE=false           # Use path-style URLs
```

## üìÅ Project Structure

```
express-api-template/
‚îú‚îÄ‚îÄ src/                        # Source code
‚îÇ   ‚îú‚îÄ‚îÄ config/                 # Configuration files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.js         # Database configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js           # Winston logger configuration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swagger.js          # Swagger API documentation setup
‚îÇ   ‚îú‚îÄ‚îÄ controllers/            # Request handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js   # Authentication endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ uploadController.js # File upload endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userController.js   # User management endpoints
‚îÇ   ‚îú‚îÄ‚îÄ middleware/             # Express middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js             # JWT authentication middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js     # Global error handling
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rateLimiter.js      # Rate limiting middleware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validate.js         # Input validation middleware
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # Sequelize database models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js            # Model registry and associations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js             # User model with authentication
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Product.js          # Product model example
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Category.js         # Category model example
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Order.js            # Order model example
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OrderItem.js        # Order item model example
‚îÇ   ‚îú‚îÄ‚îÄ routes/                 # Express route definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js             # Authentication routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload.js           # File upload routes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.js            # User management routes
‚îÇ   ‚îú‚îÄ‚îÄ services/               # Business logic layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authService.js      # Authentication business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ emailService.js     # Email sending service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fileService.js      # File handling service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ s3Service.js        # S3-compatible storage service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userService.js      # User management service
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # Utility functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dateUtils.js        # Date operations with dayjs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stringUtils.js      # String transformations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validationUtils.js  # Data validation helpers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cryptoUtils.js      # Cryptographic functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ responseUtils.js    # API response helpers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fileUtils.js        # File operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrationGenerator.js # Migration generation utility
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js            # Utils entry point
‚îÇ   ‚îú‚îÄ‚îÄ validators/             # Input validation schemas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ authValidator.js    # Authentication validation
‚îÇ   ‚îú‚îÄ‚îÄ migrations/             # Database migrations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 20240101000001-create-user.js # User table migration
‚îÇ   ‚îú‚îÄ‚îÄ seeders/                # Database seeders
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 20240101000001-demo-users.js # Demo user data
‚îÇ   ‚îú‚îÄ‚îÄ templates/              # Email templates
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ welcome.hbs         # Welcome email template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reset-password.hbs  # Password reset template
‚îÇ   ‚îî‚îÄ‚îÄ server.js               # Application entry point
‚îú‚îÄ‚îÄ scripts/                    # Build and utility scripts
‚îÇ   ‚îú‚îÄ‚îÄ migrate.js              # üÜï Unified migration CLI
‚îÇ   ‚îú‚îÄ‚îÄ migrate-gen.js          # Legacy manual migration CLI
‚îÇ   ‚îî‚îÄ‚îÄ smart-migrate.js        # Legacy smart migration analyzer
‚îú‚îÄ‚îÄ tests/                      # Unit test suites (168+ tests)
‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.test.js  # Authentication middleware tests
‚îÇ   ‚îú‚îÄ‚îÄ authService.test.js     # Authentication service tests
‚îÇ   ‚îú‚îÄ‚îÄ authValidator.test.js   # Authentication validation tests
‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.test.js    # Error handling tests
‚îÇ   ‚îú‚îÄ‚îÄ fileService.test.js     # File service tests
‚îÇ   ‚îú‚îÄ‚îÄ userService.test.js     # User service tests
‚îÇ   ‚îî‚îÄ‚îÄ utils.test.js           # Utility functions tests
‚îú‚îÄ‚îÄ examples/                   # Usage examples and demos
‚îÇ   ‚îî‚îÄ‚îÄ utils-examples.js       # Comprehensive utils demonstration
‚îú‚îÄ‚îÄ uploads/                    # Local file storage (created automatically)
‚îú‚îÄ‚îÄ logs/                       # Application logs (created automatically)
‚îú‚îÄ‚îÄ coverage/                   # Test coverage reports (generated)
‚îú‚îÄ‚îÄ .env.example                # Environment variables template
‚îú‚îÄ‚îÄ package.json                # Dependencies and scripts
‚îú‚îÄ‚îÄ Dockerfile                  # Default Docker configuration (Node.js)
‚îú‚îÄ‚îÄ Dockerfile.nodejs           # Node.js optimized Docker configuration
‚îú‚îÄ‚îÄ Dockerfile.bun              # Bun optimized Docker configuration
‚îú‚îÄ‚îÄ docker-compose.nodejs.yml   # Production deployment with Node.js
‚îú‚îÄ‚îÄ docker-compose.bun.yml      # Production deployment with Bun
‚îú‚îÄ‚îÄ docker-compose.dev.yml      # Development environment
‚îî‚îÄ‚îÄ README.md                   # üìñ This comprehensive documentation
```

### Key Features by Directory

- **`src/utils/migrationGenerator.js`** - üÜï **Core migration generation engine**
- **`scripts/migrate.js`** - üÜï **Unified CLI for all migration operations**
- **`src/utils/`** - **Comprehensive utility library** with dayjs integration (168+ tests)
- **`src/models/`** - **Example models** with relations and foreign keys
- **`tests/`** - **Comprehensive test suite** with Jest
- **`examples/`** - **Usage examples** and demonstrations
- **Docker files** - **Multiple deployment configurations** (Node.js, Bun)
- **Environment files** - **Production-ready** configuration templates

## üéØ Key Highlights

### üöÄ **Development Speed**
- **Zero Database Setup**: SQLite works out of the box
- **Automated Migrations**: Generate migrations from models automatically
- **Hot Reload**: Development server with automatic restart
- **Comprehensive Utils**: 168+ tested utility functions

### üõ°Ô∏è **Production Ready**
- **Security Best Practices**: Helmet, CORS, Rate limiting, Input validation
- **Multiple Runtimes**: Node.js and Bun support
- **Docker Deployment**: Production-optimized containers
- **Error Handling**: Centralized error management
- **Logging**: Structured logging with Winston

### üìä **Scalability**
- **Database Flexibility**: SQLite, MySQL, PostgreSQL support
- **File Storage Options**: Local and S3-compatible storage
- **Redis Integration**: Caching and session management
- **Image Processing**: Automatic optimization and format conversion

### üß™ **Quality Assurance**
- **Test Coverage**: 168+ comprehensive tests
- **Code Quality**: ESLint configuration and best practices
- **API Documentation**: Auto-generated Swagger docs
- **Type Safety**: JSDoc annotations

## üöÄ Production Deployment

1. Set `NODE_ENV=production` in your environment
2. Configure production database
3. Set secure JWT secret
4. Configure SMTP for emails
5. Set up SSL/TLS
6. Configure reverse proxy (nginx)
7. Set up monitoring and logging

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## üìÑ License

This project is licensed under the MIT License.

## üÜò Support

For support and questions:

- Create an issue on GitHub
- Check the API documentation at `/api-docs`
- Review the test files for usage examples
- Run `npm run examples` to see utility functions in action

---

**Happy coding! üéâ**

This template provides everything you need to build a modern, scalable Express.js API with automated database migrations, comprehensive testing, and production-ready features.
